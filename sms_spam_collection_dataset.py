# -*- coding: utf-8 -*-
"""SMS Spam Collection Dataset.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1ZrWpaGB8ObjlrCSKuklK0LE4fRWvjWuS
"""

from google.colab import files

uploaded = files.upload()

import pandas as pd
import numpy as np

from sklearn.model_selection import train_test_split
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.svm import SVC
from sklearn.metrics import accuracy_score, classification_report

import pickle

df = pd.read_csv("spam.csv", encoding="latin-1")[["v1", "v2"]]
df.columns = ["label", "text"]

print(df.head())

df["label_num"] = df["label"].map({"ham": 0, "spam": 1})

X = df["text"]
y = df["label_num"]

X_train, X_test, y_train, y_test = train_test_split(
    df['message'],
    df['label_num'],
    test_size=0.2,
    random_state=42
)

print(f"Training samples: {len(X_train)}")
print(f"Testing samples: {len(X_test)}")

X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42, stratify=y
)

tfidf = TfidfVectorizer(stop_words="english", lowercase=True)

X_train_tfidf = tfidf.fit_transform(X_train)
X_test_tfidf = tfidf.transform(X_test)

svc_model = SVC(
    kernel="linear",
    probability=True,
    class_weight={0: 1, 1: 3}  # penalize spam mistakes more
)


svc_model.fit(X_train_tfidf, y_train)

y_pred = svc_model.predict(X_test_tfidf)

print("Accuracy:", accuracy_score(y_test, y_pred))
print(classification_report(y_test, y_pred))

pickle.dump(svc_model, open("model.pkl", "wb"))
pickle.dump(tfidf, open("vectorizer.pkl", "wb"))

print("âœ… Model and vectorizer saved successfully!")

print(type(svc_model))
print(type(tfidf))

import os
os.listdir()

from google.colab import files

files.download("model.pkl")
files.download("vectorizer.pkl")

def predict_spam(text):
    text_transformed = tfidf.transform([text])
    prediction = svc_model.predict(text_transformed)
    return "Spam" if prediction[0] == 1 else "Ham"

sample_message = "Congratulations! You've won a $1,000 Walmart Gift Card. Click here to claim now!"
print(f"Message: {sample_message}")
print(f"Prediction: {predict_spam(sample_message)}")

def predict_spam(text):
    text_transformed = tfidf.transform([text])
    prediction = svc_model.predict(text_transformed)
    return "Spam" if prediction[0] == 1 else "Ham"

sample_message = "Hey, are we still going to the gym tonight? Let me know."
print(f"Message: {sample_message}")
print(f"Prediction: {predict_spam(sample_message)}")

